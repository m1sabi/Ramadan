<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <!-- Ensures the page is responsive on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>توقيت صلاة الفجر والعشاء في أوروبا</title>
  <link rel="stylesheet" href="styles-big.css">
  <link rel="stylesheet" href="styles-media.css">
  
  <meta property="og:image" content="images/omawi.png" />
  <meta property="og:title" content="توقيت صلاة الفجر والعشاء في أوروبا" />
  <meta property="og:description" content="To increases our awareness" />
  <link rel="icon" href="images/omawi.png" type="image/x-icon" />
  <link rel="shortcut icon" href="images/omawi.png" type="image/x-icon" />
</head>
<body>

<div class="outer-container">
<!-- Right column (Prayer Time Content) -->
<div class="column text-column">
<div class="centered">
	

    <p class="centered">
		<div id="countdown" style="font-size: 1.2rem; font-weight: bold; color: red;"></div>
		
        توقيت صلاة الفجر والعشاء حسب فتوى مجلس الإفتاء الأوروبي - 2015
        <br><span class="gr centered">طيلة أيام شهر رمضان المبارك</span>
        <br><span style="font-size: 0.7rem;">حسب قاعدة ساعة و5 دقائق - قبل الشروق .. وبعد الغروب</span>
    </p>

    <div class="centered-container"> <!-- Ensure tables are stacked -->
    
        <!-- First Table: City Selection -->
        <div class="selectors">
            <table class="common-table">
                <tr class="tr-city">
                    <td id="td-ctiy">
                        <div class="icon-row">
                            <div id="div-city">
                                <select id="citySelect" style="width: 150px; margin-top: 3px;"></select>
                            </div>
                            <div class="div-day">
                                <select id="daySelect" style="width: 88px; margin-top: 3px;"></select>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <!-- Second Table: Latitude -->
        <div class="div-latitude">
            <table class="common-table">
                <tr class="tr-Latitude">
                    <td id="td-Latitude">
                        <div class="icon-row">
                            <div id="cell1-latitude">
                                <span>(خط العرض):</span>
                            </div>
                            <div id="cell2-latitude">
                                <span id="latitudeCell" style="text-align: right;">—</span>
                            </div>
                            <div id="before-clock">
                                <span></span>
                            </div>
                            <div id="digitalClock">
                                <!-- Clock content here -->
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <!-- Third Table: Prayer Times -->
        <div class="div-times">
            <table class="common-table">
                <tr class="tr-times">
                    <th>اليوم</th>
                    <th id="selectedDayCell" style="font-size: 0.9rem; font-weight: bold;">—</th>
                    <th style="font-size: 0.8rem;">الفطور قياساً لمكة</th>
                </tr>
                <tr class="tr-times">
                    <th>الشروق</th>
                    <td class="td-times" id="sunriseCell">—</td>
                    <td class="td-times">—</td>
                </tr>
                <tr class="row-separator tr-times">
                    <th>الفجر</th>
                    <td class="td-times" id="fajrCell">—</td>
                    <td class="td-times">—</td>
                </tr>
                <tr class="tr-times">
                    <th>الغروب</th>
                    <td class="td-times" id="sunsetCell">—</td>
                    <td class="td-times" id="makkaFotorCell" class="green-text">—</td>
                </tr>
                <tr class="tr-times">
                    <th>العشاء</th>
                    <td class="td-times" id="ishaaCell">—</td>
                    <td class="td-times">—</td>
                </tr>
            </table>
        </div>
		<audio id="azanSound" src="azan/hasan-bl3lol.mp3" preload="auto"></audio>
		<div style="display: flex; align-items: center;">
		  <button onclick="stopAzan()">⏹️ إيقاف الأذان</button>
		  <div id="azan-list" style="display: flex; align-items: center; margin-left: 10px;">
			<label for="soundSelect" style="margin-right: 5px;">اختيار مؤذن</label>
			<select id="soundSelect" style="margin-right: 5px; margin-left: 5px;">
				<option value="azan/hasan-bl3lol.mp3">حسن بعلول</option>
				<option value="azan/haddad.mp3">أحمد حداد</option>
				<option value="azan/adham-sharkawi.mp3">أدهم شرقاوي</option>
				<option value="azan/trabulsi.mp3">أحمد طرابلسي</option>
				<option value="azan/Badi3-Jado.mp3">بديع جادو</option>
				<option value="azan/Izziddin-Amarna.mp3">عز الدين عمارنة</option>
				<option value="azan/Mahmoud-Najjar.mp3">محمود النجار</option>
				<option value="azan/Samer-Saghir.mp3">سامر الصغير</option>
				<!-- Add more options as needed -->
			</select>
			<button id="previewBtn">&#9654;</button>
		  </div>
		</div>

</div>

		  <div id="city-list-container2">
			فقط في اليوم (غير الطبيعي) -أي الذي يزيد طول النهار فيه على 18 ساعة ويقصر الليل فيه عن 10 ساعات- يكون توقيت الفطور فارقاً اعتماداً على توقيت مكة للمدن الواقعة شمال خط العرض 49، أما في الشتاء فقد يتساويان أو يكون النهار هنا -في أوروبا- أقصر.
		  </div>
		<!--<p id="exp1"><span><a href="explain.html">ماذا تعرف عن قاعدة ساعة و5 دقائق؟</a></span></p>-->
		<p style="display: flex; justify-content: center; gap: 20px;">
			<a href="explain.html">قاعدة ساعة و5 دقائق</a>
			<a href="high-latitudes.html">مشكلة خطوط العرض العليا</a>
		</p>
		<p style="display: flex; justify-content: center; gap: 20px;">
			<a href="sh-zarka.html">رأي الشيخ مصطفى الزرقا</a>
		</p>
		

    </div> <!-- End centered-container -->

</div> <!-- End centered -->
  
  <script>
	const allCitiesData = {}; // 🔥 This must come FIRST
  </script>
  <script src="cities-oreg/Berlin.js"></script>
  <script src="cities-oreg/Bremen.js"></script>
  <script src="cities-oreg/Dortmund.js"></script>
  <script src="cities-oreg/Duesseldorf.js"></script>
  <script src="cities-oreg/Erfurt.js"></script>
  <script src="cities-oreg/Frankfurt.js"></script>
  <script src="cities-oreg/Freiburg.js"></script>
  <script src="cities-oreg/Friedrichshafen.js"></script>
  <script src="cities-oreg/Hamburg.js"></script>
  <script src="cities-oreg/Karlsruhe.js"></script>
  <script src="cities-oreg/Konstanz.js"></script>
  <script src="cities-oreg/Kristianstad.js"></script>
  <script src="cities-oreg/Leipzig.js"></script>
  <script src="cities-oreg/Muenchen.js"></script>
  <script src="cities-oreg/Neu_Ulm.js"></script>
  <script src="cities-oreg/Nuremberg.js"></script>
  <script src="cities-oreg/Ravensburg.js"></script>
  <script src="cities-oreg/Sibbhult.js"></script>
  <script src="cities-oreg/Stuttgart.js"></script>
  <script src="cities-oreg/Ulm.js"></script>
  
  
  <script src="makka.js"></script>
  
  <!--<script src="cities-data.js"></script>-->
  <!--<script type="module">
  const cityFiles = [
    "Berlin.js", "Bremen.js", "Dortmund.js", "Duesseldorf.js", "Erfurt.js",
    "Frankfurt.js", "Freiburg.js", "Friedrichshafen.js", "Hamburg.js", "Karlsruhe.js",
    "Konstanz.js", "Kristianstad.js", "Leipzig.js", "Muenchen.js", "Neu_Ulm.js",
    "Nuremberg.js", "Ravensburg.js", "Sibbhult.js", "Stuttgart.js", "Ulm.js"
  ];
  const cityKey = file.replace(".js", "").toLowerCase().replace(/_/g, "_");

  const allCitiesData = {};

  async function loadCities() {
    for (const file of cityFiles) {
      const module = await import(`./cities-oreg/${file}`);
      const cityKey = file.replace(".js", "").toLowerCase().replace(/_/g, "_");
      allCitiesData[cityKey] = module[cityKey];
    }

    // Now `allCitiesData` is ready for use
    window.allCitiesData = allCitiesData; // Make globally accessible if needed
    console.log("✅ All city data loaded:", allCitiesData);

    // Now you can call your initialization like:
    if (typeof initializeUI === "function") {
      initializeUI(); // assuming you have this defined
    }
  }

  loadCities();
</script>-->

  <script src="service-worker.js"></script>

  <script>
    // Now we can access `allCitiesData` from cities-data.js
    console.log(allCitiesData.stuttgart);
  </script>
  <!-- read the list of cities -->
  <script>
    // cityListHtml is now available here
    document.addEventListener("DOMContentLoaded", () => {
      // 1) Create a container or target element
      const cityListContainer = document.getElementById("city-list-container");
      // 2) Insert the HTML from cities-data.js
      cityListContainer.innerHTML = cityListHtml;
    });
  </script>
  <script>
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("service-worker.js")
            .then(reg => console.log("Service Worker Registered ✅", reg))
            .catch(err => console.error("Service Worker Registration Failed ❌", err));
    }
  </script>
  <script>
    // ========================= DOM REFERENCES =========================
    const citySelect   = document.getElementById("citySelect");
    const daySelect    = document.getElementById("daySelect");
    const prevDayBtn   = document.getElementById("prevDayBtn");
    const nextDayBtn   = document.getElementById("nextDayBtn");

    const selectedDayCell = document.getElementById("selectedDayCell");
    const sunriseCell     = document.getElementById("sunriseCell");
    const sunsetCell      = document.getElementById("sunsetCell");
    const fajrCell        = document.getElementById("fajrCell");
    const ishaaCell       = document.getElementById("ishaaCell");

    // ========================= UTILITY FUNCTIONS =========================
    function timeToMinutes(t) {
      // "HH:MM" -> total minutes
      const [hh, mm] = t.split(":").map(Number);
      return hh * 60 + mm;
    }
	function extractTime(hiso) {
		// Converts "2025-01-03T08:14:26+01:00" → "08:14"
		return hiso.split("T")[1].slice(0, 5);
	}

    function minutesToTime(m) {
      // total minutes -> "HH:MM" (24h)
      const hh = Math.floor(m / 60);
      const mm = m % 60;
      // Pad with leading zeros if needed
      return String(hh).padStart(2, "0") + ":" + String(mm).padStart(2, "0");
    }
    function subtract1h05(timeStr) {
      return minutesToTime(timeToMinutes(timeStr) - 65);
    }
    function add1h05(timeStr) {
      return minutesToTime(timeToMinutes(timeStr) + 65);
    }

    // ========================= High Latitude Data =========================
    // List of city keys with latitude >= 49°
    const highLatCities = [
      "dortmund", "bremen", "duesseldorf", "essen", "leipzig",
      "berlin", "nuremberg", "karlsruhe", "mannheim", "frankfurt",
      "kiel", "hamburg", "koblenz", "regensburg", "erfurt",
      "rostock", "flensburg", "sibbhult", "kristianstad"
    ];
    // Makkah's sunrise and sunset times for days 1–30 (March 2025)    

    // ========================= ARROW HANDLERS =========================
    function goPrevDay() {
      let d = parseInt(daySelect.value, 10);
      if (d > 1) {
        daySelect.value = (d - 1).toString();
        updateTable();
      }
    }
    function goNextDay() {
      let d = parseInt(daySelect.value, 10);
      if (d < 30) {
        daySelect.value = (d + 1).toString();
        updateTable();
      }
    }

    // ========================= EVENT LISTENERS =========================
    citySelect.addEventListener("change", () => {
      // When user changes city, reset day to 1 for simplicity
      daySelect.value = "1";
      updateTable();
    });
    daySelect.addEventListener("change", updateTable);
    prevDayBtn.addEventListener("click", goPrevDay);
    nextDayBtn.addEventListener("click", goNextDay);

    // ========================= INITIALIZE DEFAULT SELECTION =========================
    citySelect.value = cityNames[0];   // default to first city
    daySelect.value = "1";            // default to day 1
    updateTable();
  </script>

  <!-- Container for city list (inserted via script) -->
  

  <script>
  document.addEventListener("DOMContentLoaded", () => {
  const citySelect = document.getElementById("citySelect");
  const daySelect = document.getElementById("daySelect");
  const prevDayBtn = document.getElementById("prevDayBtn");
  const nextDayBtn = document.getElementById("nextDayBtn");
  const selectedDayCell = document.getElementById("selectedDayCell");
  const sunriseCell = document.getElementById("sunriseCell");
  const sunsetCell = document.getElementById("sunsetCell");
  const fajrCell = document.getElementById("fajrCell");
  const ishaaCell = document.getElementById("ishaaCell");
  const makkaFotorCell = document.getElementById("makkaFotorCell");
  const soundSelect = document.getElementById("soundSelect");
  const previewBtn = document.getElementById("previewBtn");
  const azanSound = document.getElementById("azanSound");

  // Load stored city or default to first city
  const savedCity = localStorage.getItem("selectedCity");
  citySelect.value = savedCity || citySelect.options[0].value;

  // Load saved sound selection from localStorage (if available)
  let savedSound = localStorage.getItem("azanSound");
  if (!savedSound) {
    savedSound = soundSelect.value;  // default value from the select element
    localStorage.setItem("azanSound", savedSound);
  }
  soundSelect.value = savedSound;
  azanSound.src = savedSound;
  azanSound.load(); // Ensure the audio file is loaded

  // When the selection changes, update the audio source and save the choice
  soundSelect.addEventListener("change", () => {
    const selectedSound = soundSelect.value;
    azanSound.src = selectedSound;
    localStorage.setItem("azanSound", selectedSound);
    azanSound.load(); // Reload the new sound
  });

  // Allow the user to preview the sound by clicking the button
  previewBtn.addEventListener("click", () => {
    azanSound.play().catch(error => {
      console.error("Audio playback failed:", error);
    });
  });

  // Set today's date
  const today = new Date();
  const todayDay = today.getDate();
  daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";  

  citySelect.addEventListener("change", () => {
    daySelect.value = "1"; // Reset to first day when changing city
    updateTable();
  });
  daySelect.addEventListener("change", updateTable);
  prevDayBtn.addEventListener("click", () => {
    let d = parseInt(daySelect.value, 10);
    if (d > 1) {
      daySelect.value = (d - 1).toString();
      updateTable();
    }
  });
  nextDayBtn.addEventListener("click", () => {
    let d = parseInt(daySelect.value, 10);
    if (d < 30) {
      daySelect.value = (d + 1).toString();
      updateTable();
    }
  });

  updateTable(); // Load initial data
});
;
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const citySelect = document.getElementById("citySelect");
      const daySelect = document.getElementById("daySelect");
      const prevDayBtn = document.getElementById("prevDayBtn");
      const nextDayBtn = document.getElementById("nextDayBtn");
      const selectedDayCell = document.getElementById("selectedDayCell");
      const sunriseCell = document.getElementById("sunriseCell");
      const sunsetCell = document.getElementById("sunsetCell");
      const fajrCell = document.getElementById("fajrCell");
      const ishaaCell = document.getElementById("ishaaCell");
      const makkaFotorCell = document.getElementById("makkaFotorCell");

      // Load stored city or default to first city
      const savedCity = localStorage.getItem("selectedCity");
      citySelect.value = savedCity || citySelect.options[0].value;
	  // Prevent duplication:
	  citySelect.innerHTML = "";

	  for (let city in allCitiesData) {
		let option = document.createElement("option");
		option.value = city;
		option.textContent = city.charAt(0).toUpperCase() + city.slice(1);
		citySelect.appendChild(option);
	  }
      // Populate the day dropdown (1 to 30)
      for (let i = 1; i <= 30; i++) {
        let option = document.createElement("option");
        option.value = i.toString();
        option.textContent = `اليوم ${i}`;
        daySelect.appendChild(option);
      }

      // Set today's date
      const today = new Date();
      const todayDay = today.getDate();
      daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";      

      citySelect.addEventListener("change", () => {
        daySelect.value = "1"; // Reset to first day when changing city
        updateTable();
      });
      daySelect.addEventListener("change", updateTable);
      prevDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d > 1) {
			daySelect.value = (d - 1).toString(); // Set new value
			updateTable(); // Refresh table
        }
      });
      nextDayBtn.addEventListener("click", () => {
        let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d < 30) {
			daySelect.value = (d + 1).toString(); // Set new value
			updateTable();
        }
      });

      updateTable(); // Load initial data
    });
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const citySelect = document.getElementById("citySelect");
      const daySelect = document.getElementById("daySelect");
      const prevDayBtn = document.getElementById("prevDayBtn");
      const nextDayBtn = document.getElementById("nextDayBtn");
      const selectedDayCell = document.getElementById("selectedDayCell");
      const sunriseCell = document.getElementById("sunriseCell");
      const sunsetCell = document.getElementById("sunsetCell");
      const fajrCell = document.getElementById("fajrCell");
      const ishaaCell = document.getElementById("ishaaCell");
      const makkaFotorCell = document.getElementById("makkaFotorCell");

      // Load stored city or default to first city
      const savedCity = localStorage.getItem("selectedCity");
      citySelect.value = savedCity || citySelect.options[0].value;

      // Populate the day dropdown (1 to 30)
      for (let i = 1; i <= 30; i++) {
        let option = document.createElement("option");
        option.value = i.toString();
        option.textContent = `اليوم ${i}`;
        daySelect.appendChild(option);
      }

      // Set today's date
      const today = new Date();
      const todayDay = today.getDate();
      daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";

      citySelect.addEventListener("change", () => {
        daySelect.value = "1"; // Reset to first day when changing city
        updateTable();
      });
      daySelect.addEventListener("change", updateTable);
      prevDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d > 1) {
			daySelect.value = (d - 1).toString(); // Set new value
			updateTable(); // Refresh table
        }
      });
      nextDayBtn.addEventListener("click", () => {
        let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d < 30) {
			daySelect.value = (d + 1).toString(); // Set new value
			updateTable();
        }
      });

      updateTable(); // Load initial data
    });
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const citySelect = document.getElementById("citySelect");
      const daySelect = document.getElementById("daySelect");
      const prevDayBtn = document.getElementById("prevDayBtn");
      const nextDayBtn = document.getElementById("nextDayBtn");
      const selectedDayCell = document.getElementById("selectedDayCell");
      const sunriseCell = document.getElementById("sunriseCell");
      const sunsetCell = document.getElementById("sunsetCell");
      const fajrCell = document.getElementById("fajrCell");
      const ishaaCell = document.getElementById("ishaaCell");
      const makkaFotorCell = document.getElementById("makkaFotorCell");
      const latitudeCell = document.getElementById("latitudeCell");

      // Load stored city or default to first city
      const savedCity = localStorage.getItem("selectedCity");
      citySelect.value = savedCity || citySelect.options[0].value;

      // Populate the day dropdown (1 to 30)
      for (let i = 1; i <= 30; i++) {
        let option = document.createElement("option");
        option.value = i.toString();
        option.textContent = `اليوم ${i}`;
        daySelect.appendChild(option);
      }

      // Set today's date
      const today = new Date();
      const todayDay = today.getDate();
      daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";

      citySelect.addEventListener("change", () => {
        daySelect.value = "1"; // Reset to first day when changing city
        updateTable();
      });
      daySelect.addEventListener("change", updateTable);
      prevDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d > 1) {
			daySelect.value = (d - 1).toString(); // Set new value
			updateTable(); // Refresh table
        }
      });
      nextDayBtn.addEventListener("click", () => {
        let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d < 30) {
			daySelect.value = (d + 1).toString(); // Set new value
			updateTable();
        }
      });

      updateTable(); // Load initial data
    });
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const citySelect = document.getElementById("citySelect");
      const daySelect = document.getElementById("daySelect");
      const prevDayBtn = document.getElementById("prevDayBtn");
      const nextDayBtn = document.getElementById("nextDayBtn");
      const selectedDayCell = document.getElementById("selectedDayCell");
      const sunriseCell = document.getElementById("sunriseCell");
      const sunsetCell = document.getElementById("sunsetCell");
      const fajrCell = document.getElementById("fajrCell");
      const ishaaCell = document.getElementById("ishaaCell");
      const makkaFotorCell = document.getElementById("makkaFotorCell");
      const latitudeCell = document.getElementById("latitudeCell");
		daySelect.innerHTML = "";
      // Populate city dropdown

      // Load stored city or default to first city
      const savedCity = localStorage.getItem("selectedCity");
      citySelect.value = savedCity || citySelect.options[0].value;

      // Populate the day dropdown (1 to 30)
      for (let i = 1; i <= 30; i++) {
        let option = document.createElement("option");
        option.value = i.toString();
        option.textContent = `اليوم ${i}`;
        daySelect.appendChild(option);
      }

      // Set today's date
      const today = new Date();
      const todayDay = today.getDate();
      daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";

      citySelect.addEventListener("change", () => {
        daySelect.value = "1"; // Reset to first day when changing city
        updateTable();
      });
      daySelect.addEventListener("change", updateTable);
        prevDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d > 1) {
			daySelect.value = (d - 1).toString(); // Set new value
			updateTable(); // Refresh table
        }
      });
      nextDayBtn.addEventListener("click", () => {
        let d = parseInt(daySelect.value, 10); // Convert srting to number
		if (d < 30) {
			daySelect.value = (d + 1).toString(); // Set new value
			updateTable();
        }
      });

      updateTable(); // Load initial data
    });
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const citySelect = document.getElementById("citySelect");
      const daySelect = document.getElementById("daySelect");
      const prevDayBtn = document.getElementById("prevDayBtn");
      const nextDayBtn = document.getElementById("nextDayBtn");
      const selectedDayCell = document.getElementById("selectedDayCell");
      const sunriseCell = document.getElementById("sunriseCell");
      const sunsetCell = document.getElementById("sunsetCell");
      const fajrCell = document.getElementById("fajrCell");
      const ishaaCell = document.getElementById("ishaaCell");
      const makkaFotorCell = document.getElementById("makkaFotorCell");
      const latitudeCell = document.getElementById("latitudeCell");

      // Load stored city or default to first city
      const savedCity = localStorage.getItem("selectedCity");
      citySelect.value = savedCity || citySelect.options[0].value;

      // Populate the day dropdown (1 to 30)
      for (let i = 1; i <= 30; i++) {
        let option = document.createElement("option");
        option.value = i.toString();
        option.textContent = `اليوم ${i}`;
        daySelect.appendChild(option);
      }

      // Set today's date
      const today = new Date();
      const todayDay = today.getDate();
      daySelect.value = todayDay <= 30 ? todayDay.toString() : "1";      

      citySelect.addEventListener("change", () => {
        daySelect.value = "1"; // Reset to first day when changing city
        updateTable();
      });
      daySelect.addEventListener("change", updateTable);
      prevDayBtn.addEventListener("click", () => {
		let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d > 1) {
			daySelect.value = (d - 1).toString(); // Set new value
			updateTable(); // Refresh table
        }
      });
      nextDayBtn.addEventListener("click", () => {
        let d = parseInt(daySelect.value, 10); // Convert string to number
		if (d < 30) {
			daySelect.value = (d + 1).toString(); // Set new value
			updateTable();
        }
      });
	  function updateTable() {
  const city = citySelect.value.toLowerCase();
  const day = parseInt(daySelect.value, 10);
  const cityData = allCitiesData[city];
  if (!cityData) return;

  const dayStr = `2025-01-${String(day).padStart(2, '0')}`;
  const found = cityData.find(item => item.day === dayStr);
  if (!found) return;

  // Extract times from ISO format
  const sunriseTime = extractTime(found.sunrise); // "08:14"
  const sunsetTime  = extractTime(found.sunset);  // "16:07"

  sunriseCell.textContent = sunriseTime;
  sunsetCell.textContent = sunsetTime;

  const fajr = subtract1h05(sunriseTime);
  const ishaa = add1h05(sunsetTime);
  fajrCell.textContent = fajr;
  ishaaCell.textContent = ishaa;

  // Display selected date in Arabic
  const monthNamesArabic = [
    "يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو",
    "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"
  ];
  const today = new Date();
  const arabicMonth = monthNamesArabic[today.getMonth()];
  selectedDayCell.textContent = `يوم ${day} ${arabicMonth} ${today.getFullYear()}`;

  // Show latitude
  if (cityLatitude[city]) {
    latitudeCell.textContent = `${cityLatitude[city].lat}°`;
  } else {
    latitudeCell.textContent = "—";
  }

  // Handle Makkah-based Maghrib for high-latitude cities
  if (highLatCities.includes(city)) {
    const makkahDayData = makkahData.find(item => item.day === day);
    const makkahFajrData = makkahFajr.find(item => item.day === day);

    if (makkahDayData && makkahFajrData) {
      const makkahSunset = makkahDayData.sunset;
      const makkahFajr = makkahFajrData.Fajr;

      let fastMin = timeToMinutes(makkahSunset) - timeToMinutes(makkahFajr);
      if (fastMin < 0) fastMin += 24 * 60;

      const cityFajrMin = timeToMinutes(fajr);
      let maghribMin = cityFajrMin + fastMin;
      if (maghribMin >= 24 * 60) maghribMin -= 24 * 60;

      const cityMaghrib = minutesToTime(maghribMin);
      makkaFotorCell.textContent = cityMaghrib;
    } else {
      makkaFotorCell.textContent = "—";
    }
  } else {
    makkaFotorCell.textContent = "—";
  }

  // Navigation arrows
  prevDayBtn.disabled = day <= 1;
  nextDayBtn.disabled = day >= 30;

  // Save last selected city
  localStorage.setItem("selectedCity", city);
}

      updateTable(); // Load initial data
    });
  </script>
  
  <audio id="azanSound" src="hasan.mp3" preload="auto"></audio>
  


  <!-- To test Athan sound manually
  <button onclick="playAzan(); showNotification('Test Alarm');">
    🔔 Test Maghrib Alarm
  </button><br>
	 -->

<script>
// Get the Azan sound element
const azanSound = document.getElementById("azanSound");

// Register Service Worker for Push Notifications
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
    .then(reg => console.log("✅ Service Worker Registered:", reg))
    .catch(err => console.error("❌ Service Worker Error:", err));
}

// Notification permission request
document.addEventListener("DOMContentLoaded", () => {
    if ("Notification" in window) {
        Notification.requestPermission().then(permission => {
            if (permission === "granted") {
                console.log("🔔 Notification permission granted.");
            } else {
                console.log("❌ Notifications blocked by user.");
            }
        });
    } else {
        console.log("❌ Notifications are not supported in this browser.");
    }

    setInterval(checkPrayerTime, 7000); // Check every 15 sec
});

// Prevent multiple Azan triggers
let lastPlayedPrayer = "";  
let cooldown = false;

// Function to play Azan
function playAzan() {
    if (azanSound) {
        azanSound.play().catch(error => {
            console.log("🔇 Audio playback failed:", error);
        });
    }
}

// Function to stop Azan
function stopAzan() {
    if (azanSound) {
        azanSound.pause();
        azanSound.currentTime = 0;
    }
}
let countdownInterval = null;

function startCountdown(remainingSeconds) {
    const countdownElement = document.getElementById("countdown");

    // Reset existing countdown
    if (countdownInterval) {
        clearInterval(countdownInterval);
    }

    // Ensure countdown div is visible
    countdownElement.style.display = "block";

    countdownInterval = setInterval(() => {
        let min = Math.floor(remainingSeconds / 60);
        let sec = remainingSeconds % 60;
        countdownElement.innerHTML = `${min}:${sec.toString().padStart(2, "0")}`;

        if (remainingSeconds <= 0) {
            clearInterval(countdownInterval);
            countdownElement.innerHTML = "";
            countdownElement.style.display = "none";
        } else {
            remainingSeconds--;
        }
    }, 1000);
}

function updateClock() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    
    const fajrTime = document.getElementById("fajrCell").textContent.trim();
    const maghribTime = document.getElementById("sunsetCell").textContent.trim();

    const currentMinutes = now.getHours() * 60 + now.getMinutes();
    const fajrMinutes = parseInt(fajrTime.split(":")[0]) * 60 + parseInt(fajrTime.split(":")[1]);
    const maghribMinutes = parseInt(maghribTime.split(":")[0]) * 60 + parseInt(maghribTime.split(":")[1]);

    let secondsColor = "green";
    let countdownContainer = document.getElementById("countdown");

    // ✅ Now both countdown and red seconds start at **3 minutes before**
    if (fajrMinutes - currentMinutes === 3) {  
        secondsColor = "red";
        startCountdown(120); // Start 3-minute countdown
    } 
    else if (maghribMinutes - currentMinutes === 3) {
        secondsColor = "red";
        startCountdown(120);
    }
    // ✅ When prayer time comes, reset countdown and turn seconds green
    else if (fajrMinutes === currentMinutes || maghribMinutes === currentMinutes) {
        secondsColor = "green";
        countdownContainer.innerHTML = "";
        countdownContainer.style.display = "none";
    }

    document.getElementById('digitalClock').innerHTML = `
        <span>${hours}:${minutes}:<span style="color: ${secondsColor};">${seconds}</span></span>
    `;
}


// Update clock every second
setInterval(updateClock, 1000);
updateClock();
// Show Web Notification
function showNotification(prayerName) {
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.ready.then(reg => {
            reg.showNotification(`📢 ${prayerName} Time!`, {
                body: `It's time for ${prayerName}. Click to stop Azan.`,
                icon: "images/mosque1.png",
                vibrate: [200, 100, 200],
                actions: [{ action: "stop", title: "Stop Azan" }]
            });
        });
    }
}

// Display Popup Message
function showPopup(message, duration = 5) {
    const popup = document.getElementById("prayerPopup");
    const popupMessage = document.getElementById("prayerMessage");

    popupMessage.innerHTML = message; // Use innerHTML to render HTML properly
    popup.style.display = "block";

    // Automatically close after specified seconds
    setTimeout(() => {
        popup.style.display = "none";
    }, duration * 10000);
}

/*document.querySelector(".close").addEventListener("click", function () {
    document.getElementById("prayerPopup").style.display = "none";
});*/
document.addEventListener("DOMContentLoaded", () => {
    const closeButton = document.querySelector(".close");
    const popup = document.getElementById("prayerPopup");

    closeButton.addEventListener("click", function () {
        popup.style.display = "none"; // Hide the popup when 'X' is clicked
    });

    // Also close the popup if the user clicks anywhere outside it
    window.addEventListener("click", function (event) {
        if (event.target === popup) {
            popup.style.display = "none"; // Hide the popup when clicking outside it
        }
    });
});

// Check Prayer Time
function checkPrayerTime() {
    if (cooldown) return; // Stop checking if cooldown is active

    const now = new Date();
    const currentTime = now.getHours().toString().padStart(2, "0") + ":" + now.getMinutes().toString().padStart(2, "0");

    const maghribTime = document.getElementById("sunsetCell").textContent.trim();
    const fajrTime = document.getElementById("fajrCell").textContent.trim();

    if (currentTime === fajrTime && lastPlayedPrayer !== "Fajr") {
        triggerAzan("Fajr");
    } 
    else if (currentTime === maghribTime && lastPlayedPrayer !== "Maghrib") {
        triggerAzan("Maghrib");
    } 
    else if (currentTime !== fajrTime && currentTime !== maghribTime) {
        lastPlayedPrayer = ""; // Reset flag
    }
}
	function getArabicPrayerName(prayerName) {
    const names = {
        "Fajr": "الفجر",
        "Dhuhr": "الظهر",
        "Asr": "العصر",
        "Maghrib": "المغرب",
        "Isha": "العشاء"
    };
    return names[prayerName] || prayerName; // Default to input if not found
}
// Function to Trigger Azan & Notification
function triggerAzan(prayerName) {
    playAzan(); // Play the Azan sound

    const arabicName = getArabicPrayerName(prayerName);

    // Set the correct image path
    let imagePath = "images/mosque1.png"; // Default

    if (prayerName === "Fajr") {
        imagePath = "images/sunrise1.png";
    } else if (prayerName === "Maghrib") {
        imagePath = "images/sunset1.png";
    }

    // Request permission if not already granted
    if (Notification.permission === "granted") {
        showBrowserNotification(prayerName, arabicName, imagePath);
    } else if (Notification.permission !== "denied") {
        Notification.requestPermission().then(permission => {
            if (permission === "granted") {
                showBrowserNotification(prayerName, arabicName, imagePath);
            }
        });
    }

    // Show popup notification in HTML
    showPopup(`
        <img src="${imagePath}" alt="${arabicName}" 
             style="width:85px;height:60px;vertical-align:middle;" />
        <br><br>
        ! حان الآن وقت صلاة ${arabicName}
    `, 5);

    lastPlayedPrayer = prayerName; // Prevent multiple triggers
    cooldown = true; // Activate cooldown

    pauseChecking(); // Stop checking temporarily
}


// Function to Show Web Notification
function showBrowserNotification(prayerName, arabicName, imagePath) {
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.ready.then(reg => {
            reg.showNotification(`📢 ${prayerName} Time!`, {
                body: `حان الآن وقت صلاة ${arabicName}.`,
                icon: imagePath,
                vibrate: [200, 100, 200],
                actions: [{ action: "stop", title: "⏹️ إيقاف الأذان" }]
            });
        });
    } else {
        new Notification(`📢 ${prayerName} Time!`, {
            body: `حان الآن وقت صلاة ${arabicName}.`,
            icon: imagePath
        });
    }
}





// Stop checking for 2 minutes after Azan
function pauseChecking() {
    console.log("⏸️ Checking paused for 2 minutes...");
    clearInterval(checkInterval);

    setTimeout(() => {
        cooldown = false; // Re-enable checking
        checkInterval = setInterval(checkPrayerTime, 7000); // Restart checking
        console.log("▶️ Checking resumed!");
    }, 120000); // 2-minute cooldown
}

// Handle Messages from Service Worker (Stop Azan if user clicks notification)
navigator.serviceWorker.addEventListener("message", (event) => {
    if (event.data.action === "stopAzan") {
        stopAzan();
    }
});
</script>

<script>
	let wakeLock = null;

async function requestWakeLock() {
    if ("wakeLock" in navigator) {
        try {
            wakeLock = await navigator.wakeLock.request("screen");
            console.log("🔋 Wake Lock enabled!");
        } catch (err) {
            console.error("⚠️ Wake Lock failed:", err);
        }
    }
}

// Request wake lock when page loads
document.addEventListener("visibilitychange", async () => {
    if (document.visibilityState === "visible" && wakeLock === null) {
        await requestWakeLock();
    }
});
let wakeLock = null;

// Function to request Wake Lock
async function requestWakeLock() {
    if ("wakeLock" in navigator) {
        try {
            wakeLock = await navigator.wakeLock.request("screen");
            console.log("🔋 Wake Lock enabled!");
            
            // Listen for Wake Lock release (when system revokes it)
            wakeLock.addEventListener("release", () => {
                console.log("⚡ Wake Lock was released!");
                wakeLock = null;
            });

        } catch (err) {
            console.error("⚠️ Wake Lock failed:", err);
        }
    }
}

// Function to release Wake Lock
async function releaseWakeLock() {
    if (wakeLock !== null) {
        await wakeLock.release();
        wakeLock = null;
        console.log("⚡ Wake Lock released manually!");
    }
}

// Function to check if screen should stay on
function manageWakeLock() {
    const now = new Date();
    const currentMinutes = now.getHours() * 60 + now.getMinutes();

    const fajrTime = document.getElementById("fajrCell").textContent.trim();
    const maghribTime = document.getElementById("sunsetCell").textContent.trim();

    const fajrMinutes = parseInt(fajrTime.split(":")[0]) * 60 + parseInt(fajrTime.split(":")[1]);
    const maghribMinutes = parseInt(maghribTime.split(":")[0]) * 60 + parseInt(maghribTime.split(":")[1]);

    // 🟢 Keep screen ON 5 minutes before Fajr or Maghrib
    if ((fajrMinutes - currentMinutes <= 5 && currentMinutes < fajrMinutes) || 
        (maghribMinutes - currentMinutes <= 5 && currentMinutes < maghribMinutes)) {
        console.log("⏳ Requesting Wake Lock...");
        requestWakeLock();
    } 
    // 🔴 Release Wake Lock 2 minutes AFTER Fajr or Maghrib
    else if (currentMinutes >= fajrMinutes + 2 || currentMinutes >= maghribMinutes + 2) {
        console.log("🛑 Releasing Wake Lock...");
        releaseWakeLock();
    }
}

// Run the function every minute
setInterval(manageWakeLock, 60000);

// Request Wake Lock when page becomes visible again
document.addEventListener("visibilitychange", async () => {
    if (document.visibilityState === "visible") {
        manageWakeLock();
    }
});

// ✅ NEW: Request Wake Lock when user clicks anywhere
document.addEventListener("DOMContentLoaded", () => {
    document.addEventListener("click", requestWakeLock); // User tap activates Wake Lock
});



</script>
</div>
</div> <!--end of column text-column-->

<!-- Left column (Links) -->
<div class="column list-column">
    <p id="exp4">
	<span style="color: red;">ملاحظة:</span><span></span> لإصدار صوت الأذان يجب منح الإذن لمتصفح الإنترنت
	</p>
	<p id="exp2"><a href="browser-settings.html">كيفية ضبط إعدادات المتصفح لإصدار صوت الأذان</a></p>
    
	<p id="exp3">تحميل متصفح موزيلا Mozilla firefox</p>
	
<div class="icon-row">
  <div class="link-container-w">
    <a href="https://www.mozilla.org/en-US/firefox/browsers/windows-64-bit/">
      <img src="images/windows.png" alt="Download firefox for windows-64-bit">
    </a>
  </div>
  <div class="link-container-app">
    <a href="https://apps.apple.com/us/app/firefox-private-safe-browser/id989804926">
      <img src="images/App Store.png" alt="Download on the App Store">
    </a>
  </div>
  <div class="link-container-app">
    <a href="https://play.google.com/store/apps/details?id=org.mozilla.firefox">
      <img src="images/Google Play.png" alt="GET IT ON Google Play">
    </a>
  </div>
</div>
</div>
 <!--<div class="side-column"></div>-->
<button id="nextDayBtn">→ اليوم التالي</button>
<button id="prevDayBtn">اليوم السابق ←</button>
</div>
<div id="prayerPopup" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <p id="prayerMessage"></p>
    </div>
</div>
</body>
</html>
